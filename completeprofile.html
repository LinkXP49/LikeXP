<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="supabase.js"></script>
<form id="completeForm">
  <input type="file" id="avatar" accept="image/*" />
<script>
document.getElementById('avatar').onchange = (e) => {
  const file = e.target.files[0];
  if (!file) return;

  const img = document.getElementById('avatarPreview');
  img.src = URL.createObjectURL(file);
  img.style.display = 'block';
};
</script>
  <h2>Complete Your Profile</h2>

<div id="completion"></div>

<form id="completeForm">

  <label>Profile Picture</label>
  <input type="file" id="avatar" accept="image/*" />

  <label>Bio</label>
  <textarea id="bio" placeholder="Tell people who you are as a gamer"></textarea>

  <label>Birthday</label>
  <input type="date" id="birthday" />

  <label>Gender</label>
  <select id="gender">
    <option value="">Prefer not to say</option>
    <option value="male">Male</option>
    <option value="female">Female</option>
    <option value="other">Other</option>
  </select>

  <h3>Socials</h3>
  <input id="discord" placeholder="Discord username" />
  <input id="twitch" placeholder="Twitch URL" />
  <input id="youtube" placeholder="YouTube URL" />
  <input id="twitter" placeholder="X (Twitter) URL" />
  <input id="instagram" placeholder="Instagram URL" />

  <button type="submit">Save & View Profile</button>
</form>
  <script>
document.getElementById('completeForm').addEventListener('submit', async (e) => {
  e.preventDefault();

  // Ensure user is logged in
 <script>
document.getElementById('completeForm').onsubmit = async (e) => {
  e.preventDefault();

  const { data: { user } } = await supabase.auth.getUser();
  if (!user) return location.href = 'login.html';

  let avatarUrl = null;

  if (avatar.files.length) {
    const filePath = `${user.id}.jpg`;
    await supabase.storage.from('avatars')
      .upload(filePath, avatar.files[0], { upsert: true });

    avatarUrl = supabase.storage
      .from('avatars')
      .getPublicUrl(filePath).data.publicUrl;
  }

  await supabase.from('profiles').update({
    bio: bio.value,
    birthday: birthday.value,
    gender: gender.value,
    avatar_url: avatarUrl,
    socials: {
      discord: discord.value,
      twitch: twitch.value,
      youtube: youtube.value,
      twitter: twitter.value,
      instagram: instagram.value
    }
  }).eq('user_id', user.id);

  window.location.href = 'profile.html?u=' + user.user_metadata.username;
};
</script>
  const avatarFile = document.getElementById('avatar').files[0];

let avatarUrl = null;

if (avatarFile) {
  const filePath = `${user.id}.jpg`;

  await supabase.storage
    .from('avatars')
    .upload(filePath, avatarFile, {
      upsert: true
    });

  const { data } = supabase.storage
    .from('avatars')
    .getPublicUrl(filePath);

  avatarUrl = data.publicUrl;
}</script>
